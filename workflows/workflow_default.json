{
  "fileName": "Inverlink___Flujo_asistente_virtual.json",
  "fileContent": "{\n  \"createdAt\": \"2025-07-01T16:41:13.087Z\",\n  \"updatedAt\": \"2025-07-10T16:10:26.105Z\",\n  \"id\": \"lap8uRXad1sooOPt\",\n  \"name\": \"Inverlink - Flujo asistente virtual\",\n  \"active\": true,\n  \"isArchived\": false,\n  \"nodes\": [\n    {\n      \"parameters\": {\n        \"httpMethod\": \"POST\",\n        \"path\": \"ultraapi-incoming\",\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"typeVersion\": 2,\n      \"position\": [\n        500,\n        20\n      ],\n      \"id\": \"9a217174-0fb1-47b1-ba02-385684300993\",\n      \"name\": \"Webhook\",\n      \"webhookId\": \"c23f9095-e9c9-478d-8702-f55d9040f48c\"\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"6bc35d95-0ce7-4d9a-95ec-56c31803ea42\",\n              \"name\": \"from\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"data\\\"][\\\"from\\\"]}}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"6a8967fb-57c0-45e4-8c40-bf4194dbab68\",\n              \"name\": \"pushname\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"data\\\"][\\\"pushname\\\"]}}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"f8d6bf82-e47e-40a7-a52a-eaf1a7891454\",\n              \"name\": \"message\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"data\\\"][\\\"body\\\"]}}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"d9ebd23a-d7ba-402e-9949-3150086e2a9b\",\n              \"name\": \"chat_id\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"data\\\"][\\\"id\\\"]}}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"d16d6264-9cf8-45cb-99f8-ac4d137a6890\",\n              \"name\": \"type\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"data\\\"][\\\"type\\\"]}}\",\n              \"type\": \"string\"\n            }\n          ]\n        },\n        \"includeOtherFields\": true,\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        680,\n        20\n      ],\n      \"id\": \"a66eea24-7432-4e3c-8ff5-ee803a766cd4\",\n      \"name\": \"Edit Fields\"\n    },\n    {\n      \"parameters\": {\n        \"amount\": 1\n      },\n      \"type\": \"n8n-nodes-base.wait\",\n      \"typeVersion\": 1.1,\n      \"position\": [\n        1620,\n        -100\n      ],\n      \"id\": \"8ea5743c-ba43-4f74-99b1-85e85d41fffc\",\n      \"name\": \"Wait\",\n      \"webhookId\": \"1d8ce4ea-7ea9-4e9b-a986-76e953823d7e\",\n      \"notes\": \"Detiene el flujo por 10 segundos para garantizar que todos los mensajes que envien desde el destino puedan ser procesados a la vez. \"\n    },\n    {\n      \"parameters\": {\n        \"modelId\": {\n          \"__rl\": true,\n          \"value\": \"gpt-4\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"GPT-4\"\n        },\n        \"messages\": {\n          \"values\": [\n            {\n              \"content\": \"Eres un asistente administrativo de WhatsApp para empleados de la empresa. Tu misi√≥n es:\\n\\n1. Responder de forma clara, amable y breve a consultas sobre facturas (restaurantes u otros gastos).\\n2. Solicitar siempre, de forma amable:\\n   ‚Ä¢ Proyecto/Cliente:\\n   ‚Ä¢ Centro de costos:\\n3. Pedir que env√≠en la imagen de la factura (si no la han enviado a√∫n).\\n4. Si el mensaje del usuario no es claro o falta alguno de los datos anteriores, pide una aclaraci√≥n puntual antes de continuar.\\n\\nEjemplo de respuesta inicial:\\n‚ÄúHola {{pushname}} üëã, gracias por tu mensaje. Para procesar tu factura, por favor ind√≠came:\\n\\n-Proyecto/Cliente:  \\n-Centro de costos:  \\n\\nY adjunta la imagen de la factura. ¬°Gracias!‚Äù\",\n              \"role\": \"system\"\n            },\n            {\n              \"content\": \"=Mensaje recibido: {{$json.consolidated}}\\nNombre del usuario: {{ $json[\\\"pushname\\\"] }}\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"typeVersion\": 1.8,\n      \"position\": [\n        2680,\n        40\n      ],\n      \"id\": \"b48cc721-7d4b-4b75-83cd-4ef26f6a0aa5\",\n      \"name\": \"Message a model\",\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"0r1L7QIDC5ZRtM0r\",\n          \"name\": \"OpenAi\"\n        }\n      }\n    },\n    {\n      \"parameters\": {\n        \"method\": \"POST\",\n        \"url\": \"https://api.ultramsg.com/instance129404/messages/chat\",\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            }\n          ]\n        },\n        \"sendBody\": true,\n        \"bodyParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"to\",\n              \"value\": \"={{$json[\\\"to\\\"]}}\"\n            },\n            {\n              \"name\": \"body\",\n              \"value\": \"={{$json[\\\"respuesta_ia\\\"]}}\"\n            },\n            {\n              \"name\": \"token\",\n              \"value\": \"a3j7nmnegti95x5j\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.2,\n      \"position\": [\n        3180,\n        40\n      ],\n      \"id\": \"8014859f-bb44-4aa6-a9e5-e433c2e84337\",\n      \"name\": \"HTTP Request\"\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"879e3cd2-2479-4131-98c9-b1e60a95867d\",\n              \"name\": \"respuesta_ia\",\n              \"value\": \"={{$json[\\\"message\\\"][\\\"content\\\"]}}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"6ed7fb86-a8ef-4939-8236-7b1b519cc8f5\",\n              \"name\": \"to\",\n              \"value\": \"={{$item(0).$node[\\\"Edit Fields\\\"].json[\\\"from\\\"]}}\",\n              \"type\": \"string\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        3000,\n        40\n      ],\n      \"id\": \"7476fd62-47b2-48cd-85f6-4fac6aab0c45\",\n      \"name\": \"Edit Fields1\"\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"4797843f-dcb1-4042-9c27-0693153ffa0b\",\n              \"name\": \"media\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"data\\\"][\\\"media\\\"]}}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"1c49e037-e58e-43bf-89d1-86b69df2c46b\",\n              \"name\": \"from\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"data\\\"][\\\"from\\\"]}}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"62d5f85c-2ccd-4006-ab37-1428e1262d2d\",\n              \"name\": \"pushname\",\n              \"value\": \"={{$json[\\\"body\\\"][\\\"data\\\"][\\\"pushname\\\"]}}\",\n              \"type\": \"string\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        2120,\n        -200\n      ],\n      \"id\": \"11926153-5381-4f18-89aa-60f5bb027ab6\",\n      \"name\": \"Edit Fields2\"\n    },\n    {\n      \"parameters\": {\n        \"url\": \"={{$json[\\\"media\\\"]}}\",\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"responseFormat\": \"file\"\n            }\n          }\n        }\n      },\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.2,\n      \"position\": [\n        2320,\n        -200\n      ],\n      \"id\": \"85bb5176-aa01-4060-a874-4db256390167\",\n      \"name\": \"HTTP Request1\"\n    },\n    {\n      \"parameters\": {\n        \"method\": \"POST\",\n        \"url\": \"https://api.ultramsg.com/instance129404/messages/chat\",\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            }\n          ]\n        },\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"jsonBody\": \"={\\n  \\\"token\\\": \\\"a3j7nmnegti95x5j\\\",\\n  \\\"to\\\": \\\"{{$json[\\\"from\\\"]}}\\\",\\n  \\\"body\\\": \\\"¬°Hemos recibido tu imagen correctamente! Si deseas procesarla, ind√≠canos con un mensaje.\\\"\\n}\",\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.2,\n      \"position\": [\n        2520,\n        -200\n      ],\n      \"id\": \"855f120d-8231-48fa-9bf7-f434950ab1a8\",\n      \"name\": \"HTTP Request2\"\n    },\n    {\n      \"parameters\": {\n        \"resource\": \"table\",\n        \"workbook\": {\n          \"__rl\": true,\n          \"value\": \"01PHCLF5CA5JRSNYZM5NA3Q7FPQMDKZRXE\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"DB_WP\",\n          \"cachedResultUrl\": \"https://kryptocolombia-my.sharepoint.com/personal/edgar_caballero_krypto_com_co/_layouts/15/Doc.aspx?sourcedoc=%7B2663EA40-2CE3-41EB-B87C-AF8306ACC6E4%7D&file=DB_WP.xlsx&action=default&mobileredirect=true&DefaultItemOpen=1\"\n        },\n        \"worksheet\": {\n          \"__rl\": true,\n          \"value\": \"{00000000-0001-0000-0000-000000000000}\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"buffer_mensajes\",\n          \"cachedResultUrl\": \"https://kryptocolombia-my.sharepoint.com/personal/edgar_caballero_krypto_com_co/_layouts/15/Doc.aspx?sourcedoc=%7B2663EA40-2CE3-41EB-B87C-AF8306ACC6E4%7D&file=DB_WP.xlsx&action=default&mobileredirect=true&DefaultItemOpen=1&activeCell=buffer_mensajes!A1\"\n        },\n        \"table\": {\n          \"__rl\": true,\n          \"value\": \"{25770EBD-6FAD-436C-B9DD-D8972A691205}\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"Tabla3\",\n          \"cachedResultUrl\": \"https://kryptocolombia-my.sharepoint.com/personal/edgar_caballero_krypto_com_co/_layouts/15/Doc.aspx?sourcedoc=%7B2663EA40-2CE3-41EB-B87C-AF8306ACC6E4%7D&file=DB_WP.xlsx&action=default&mobileredirect=true&DefaultItemOpen=1&activeCell=buffer_mensajes!A1:C2\"\n        },\n        \"fieldsUi\": {\n          \"values\": [\n            {\n              \"column\": \"from\",\n              \"fieldValue\": \"={{$json[\\\"from\\\"]}}\"\n            },\n            {\n              \"column\": \"mensaje\",\n              \"fieldValue\": \"={{$json[\\\"message\\\"]}}\"\n            },\n            {\n              \"column\": \"timestamp\",\n              \"fieldValue\": \"={{ new Date().toISOString() }}\"\n            },\n            {\n              \"column\": \"pushname\",\n              \"fieldValue\": \"={{$json[\\\"pushname\\\"]}}\"\n            },\n            {\n              \"column\": \"type\",\n              \"fieldValue\": \"={{$json[\\\"type\\\"]}}\"\n            },\n            {\n              \"column\": \"procesado\",\n              \"fieldValue\": \"={{ $json[\\\"procesado\\\"] }}\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.microsoftExcel\",\n      \"typeVersion\": 2.1,\n      \"position\": [\n        1440,\n        -100\n      ],\n      \"id\": \"4e23c16b-f683-4600-83bf-5a550e9df6c8\",\n      \"name\": \"Append rows to table\",\n      \"credentials\": {\n        \"microsoftExcelOAuth2Api\": {\n          \"id\": \"0BgLamAe7CuNGvED\",\n          \"name\": \"Microsoft Excel account 2\"\n        }\n      }\n    },\n    {\n      \"parameters\": {\n        \"resource\": \"table\",\n        \"operation\": \"lookup\",\n        \"workbook\": {\n          \"__rl\": true,\n          \"value\": \"01PHCLF5CA5JRSNYZM5NA3Q7FPQMDKZRXE\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"DB_WP\",\n          \"cachedResultUrl\": \"https://kryptocolombia-my.sharepoint.com/personal/edgar_caballero_krypto_com_co/_layouts/15/Doc.aspx?sourcedoc=%7B2663EA40-2CE3-41EB-B87C-AF8306ACC6E4%7D&file=DB_WP.xlsx&action=default&mobileredirect=true&DefaultItemOpen=1\"\n        },\n        \"worksheet\": {\n          \"__rl\": true,\n          \"value\": \"{CAF667EF-B455-490A-B7FD-A97DE88AA0CE}\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"usuarios_autorizados\",\n          \"cachedResultUrl\": \"https://kryptocolombia-my.sharepoint.com/personal/edgar_caballero_krypto_com_co/_layouts/15/Doc.aspx?sourcedoc=%7B2663EA40-2CE3-41EB-B87C-AF8306ACC6E4%7D&file=DB_WP.xlsx&action=default&mobileredirect=true&DefaultItemOpen=1&activeCell=usuarios_autorizados!A1\"\n        },\n        \"table\": {\n          \"__rl\": true,\n          \"value\": \"{DCF0008E-65F0-4571-A054-FB39E001F0E0}\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"Tabla1\",\n          \"cachedResultUrl\": \"https://kryptocolombia-my.sharepoint.com/personal/edgar_caballero_krypto_com_co/_layouts/15/Doc.aspx?sourcedoc=%7B2663EA40-2CE3-41EB-B87C-AF8306ACC6E4%7D&file=DB_WP.xlsx&action=default&mobileredirect=true&DefaultItemOpen=1&activeCell=usuarios_autorizados!A1:B4\"\n        },\n        \"lookupColumn\": \"telefono\",\n        \"lookupValue\": \"={{$json[\\\"from\\\"]}}\",\n        \"options\": {\n          \"returnAllMatches\": true\n        }\n      },\n      \"type\": \"n8n-nodes-base.microsoftExcel\",\n      \"typeVersion\": 2.1,\n      \"position\": [\n        860,\n        20\n      ],\n      \"id\": \"f9b8ab47-3bc9-4705-876a-6b32352045f7\",\n      \"name\": \"Lookup a column\",\n      \"alwaysOutputData\": true,\n      \"credentials\": {\n        \"microsoftExcelOAuth2Api\": {\n          \"id\": \"0BgLamAe7CuNGvED\",\n          \"name\": \"Microsoft Excel account 2\"\n        }\n      },\n      \"onError\": \"continueRegularOutput\"\n    },\n    {\n      \"parameters\": {\n        \"method\": \"POST\",\n        \"url\": \"https://api.ultramsg.com/instance129404/messages/chat\",\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            }\n          ]\n        },\n        \"sendBody\": true,\n        \"specifyBody\": \"json\",\n        \"jsonBody\": \"={\\n  \\\"token\\\": \\\"a3j7nmnegti95x5j\\\",\\n  \\\"to\\\": \\\"{{$json[\\\"to\\\"]}}\\\",\\n  \\\"body\\\": \\\"Lo siento, no est√°s autorizado para interactuar conmigo.\\\"\\n}\",\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.2,\n      \"position\": [\n        1440,\n        140\n      ],\n      \"id\": \"90ac519c-6ce4-4c49-ac08-d4a7a5c7471b\",\n      \"name\": \"HTTP Request3\"\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"1a6ae683-75f2-4ea2-b777-3b7611868770\",\n              \"name\": \"from\",\n              \"value\": \"={{$node[\\\"Edit Fields\\\"].json[\\\"from\\\"]}}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"6f6f07e3-6baf-4626-9871-0466e2ea612e\",\n              \"name\": \"message\",\n              \"value\": \"={{$node[\\\"Edit Fields\\\"].json[\\\"message\\\"]}}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"af8799cc-9df7-4039-b224-6d6cc9d07478\",\n              \"name\": \"pushname\",\n              \"value\": \"={{$node[\\\"Edit Fields\\\"].json[\\\"pushname\\\"]}}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"15243338-2d82-4e41-85ae-5f174c7982e2\",\n              \"name\": \"type\",\n              \"value\": \"={{$node[\\\"Edit Fields\\\"].json[\\\"type\\\"]}}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"6d8c4453-1b1e-4709-88d2-42096fccb45e\",\n              \"name\": \"procesado\",\n              \"value\": \"false\",\n              \"type\": \"string\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        1260,\n        -100\n      ],\n      \"id\": \"da177349-b5d8-4588-b29d-1d1d1bd85308\",\n      \"name\": \"Edit Fields3\"\n    },\n    {\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"conditions\": {\n                \"options\": {\n                  \"caseSensitive\": true,\n                  \"leftValue\": \"\",\n                  \"typeValidation\": \"strict\",\n                  \"version\": 2\n                },\n                \"conditions\": [\n                  {\n                    \"leftValue\": \"={{$json[\\\"type\\\"]}}\",\n                    \"rightValue\": \"document\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"equals\"\n                    },\n                    \"id\": \"42d5173b-7d16-459f-93f4-0aa006297157\"\n                  }\n                ],\n                \"combinator\": \"and\"\n              },\n              \"renameOutput\": true,\n              \"outputKey\": \"PDF/Doc\"\n            },\n            {\n              \"conditions\": {\n                \"options\": {\n                  \"caseSensitive\": true,\n                  \"leftValue\": \"\",\n                  \"typeValidation\": \"strict\",\n                  \"version\": 2\n                },\n                \"conditions\": [\n                  {\n                    \"id\": \"3cfffa6b-ac7b-462c-8451-c53d5f51deb4\",\n                    \"leftValue\": \"={{$json[\\\"type\\\"]}}\",\n                    \"rightValue\": \"image\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"equals\",\n                      \"name\": \"filter.operator.equals\"\n                    }\n                  }\n                ],\n                \"combinator\": \"and\"\n              },\n              \"renameOutput\": true,\n              \"outputKey\": \"Image\"\n            },\n            {\n              \"conditions\": {\n                \"options\": {\n                  \"caseSensitive\": true,\n                  \"leftValue\": \"\",\n                  \"typeValidation\": \"strict\",\n                  \"version\": 2\n                },\n                \"conditions\": [\n                  {\n                    \"id\": \"006c9fa6-c6c1-4a4e-adfb-0258bfa81ddc\",\n                    \"leftValue\": \"={{$json[\\\"type\\\"]}}\",\n                    \"rightValue\": \"chat\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"equals\",\n                      \"name\": \"filter.operator.equals\"\n                    }\n                  }\n                ],\n                \"combinator\": \"and\"\n              },\n              \"renameOutput\": true,\n              \"outputKey\": \"chat\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.switch\",\n      \"typeVersion\": 3.2,\n      \"position\": [\n        1800,\n        -100\n      ],\n      \"id\": \"d7b7bf55-3703-43d1-8d18-b1c7ba787abc\",\n      \"name\": \"Switch\"\n    },\n    {\n      \"parameters\": {\n        \"conditions\": {\n          \"options\": {\n            \"caseSensitive\": true,\n            \"leftValue\": \"\",\n            \"typeValidation\": \"strict\",\n            \"version\": 2\n          },\n          \"conditions\": [\n            {\n              \"id\": \"c49c800b-6f85-427c-b703-bb293d4fcd05\",\n              \"leftValue\": \"={{$json[\\\"telefono\\\"]}}\",\n              \"rightValue\": \"\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"notEmpty\",\n                \"singleValue\": true\n              }\n            }\n          ],\n          \"combinator\": \"and\"\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.if\",\n      \"typeVersion\": 2.2,\n      \"position\": [\n        1040,\n        20\n      ],\n      \"id\": \"7d9194d6-292c-430a-9847-ad178426492f\",\n      \"name\": \"If1\"\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"a4d9e25e-f233-4782-9e6e-83f303745206\",\n              \"name\": \"to\",\n              \"value\": \"={{$node[\\\"Edit Fields\\\"].json[\\\"from\\\"]}}\",\n              \"type\": \"string\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        1260,\n        140\n      ],\n      \"id\": \"9ba07131-aae0-48d4-99ca-29c3d7d87188\",\n      \"name\": \"Edit Fields4\"\n    },\n    {\n      \"parameters\": {\n        \"resource\": \"table\",\n        \"operation\": \"getRows\",\n        \"workbook\": {\n          \"__rl\": true,\n          \"value\": \"01PHCLF5CA5JRSNYZM5NA3Q7FPQMDKZRXE\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"DB_WP\",\n          \"cachedResultUrl\": \"https://kryptocolombia-my.sharepoint.com/personal/edgar_caballero_krypto_com_co/_layouts/15/Doc.aspx?sourcedoc=%7B2663EA40-2CE3-41EB-B87C-AF8306ACC6E4%7D&file=DB_WP.xlsx&action=default&mobileredirect=true&DefaultItemOpen=1\"\n        },\n        \"worksheet\": {\n          \"__rl\": true,\n          \"value\": \"{00000000-0001-0000-0000-000000000000}\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"buffer_mensajes\",\n          \"cachedResultUrl\": \"https://kryptocolombia-my.sharepoint.com/personal/edgar_caballero_krypto_com_co/_layouts/15/Doc.aspx?sourcedoc=%7B2663EA40-2CE3-41EB-B87C-AF8306ACC6E4%7D&file=DB_WP.xlsx&action=default&mobileredirect=true&DefaultItemOpen=1&activeCell=buffer_mensajes!A1\"\n        },\n        \"table\": {\n          \"__rl\": true,\n          \"value\": \"{25770EBD-6FAD-436C-B9DD-D8972A691205}\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"Tabla3\",\n          \"cachedResultUrl\": \"https://kryptocolombia-my.sharepoint.com/personal/edgar_caballero_krypto_com_co/_layouts/15/Doc.aspx?sourcedoc=%7B2663EA40-2CE3-41EB-B87C-AF8306ACC6E4%7D&file=DB_WP.xlsx&action=default&mobileredirect=true&DefaultItemOpen=1&activeCell=buffer_mensajes!A1:F27\"\n        },\n        \"returnAll\": true,\n        \"filters\": {\n          \"column\": [\n            \"from\",\n            \"procesado\"\n          ]\n        }\n      },\n      \"type\": \"n8n-nodes-base.microsoftExcel\",\n      \"typeVersion\": 2.1,\n      \"position\": [\n        2120,\n        40\n      ],\n      \"id\": \"f866bee0-5abe-4071-a43d-09775c07c248\",\n      \"name\": \"msg_consol\",\n      \"credentials\": {\n        \"microsoftExcelOAuth2Api\": {\n          \"id\": \"0BgLamAe7CuNGvED\",\n          \"name\": \"Microsoft Excel account 2\"\n        }\n      }\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// items son todas las filas de buffer_mensajes para este usuario\\nconst rows = items.map(i => i.json);\\nconst consolidated = rows.map(r => r.mensaje).join('\\\\n');\\nconst timestamps = rows.map(r => r.timestamp); // o el campo clave que uses\\nreturn [{\\n  json: {\\n    from: rows[0].from,\\n    consolidated,\\n    rowsToUpdate: timestamps\\n  }\\n}];\"\n      },\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        2320,\n        40\n      ],\n      \"id\": \"fccaa758-27b8-4869-85dd-a6598a98b4c1\",\n      \"name\": \"msg_agrupado\"\n    },\n    {\n      \"parameters\": {\n        \"resource\": \"worksheet\",\n        \"operation\": \"update\",\n        \"workbook\": {\n          \"__rl\": true,\n          \"value\": \"01PHCLF5CA5JRSNYZM5NA3Q7FPQMDKZRXE\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"DB_WP\",\n          \"cachedResultUrl\": \"https://kryptocolombia-my.sharepoint.com/personal/edgar_caballero_krypto_com_co/_layouts/15/Doc.aspx?sourcedoc=%7B2663EA40-2CE3-41EB-B87C-AF8306ACC6E4%7D&file=DB_WP.xlsx&action=default&mobileredirect=true&DefaultItemOpen=1\"\n        },\n        \"worksheet\": {\n          \"__rl\": true,\n          \"value\": \"{00000000-0001-0000-0000-000000000000}\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"buffer_mensajes\",\n          \"cachedResultUrl\": \"https://kryptocolombia-my.sharepoint.com/personal/edgar_caballero_krypto_com_co/_layouts/15/Doc.aspx?sourcedoc=%7B2663EA40-2CE3-41EB-B87C-AF8306ACC6E4%7D&file=DB_WP.xlsx&action=default&mobileredirect=true&DefaultItemOpen=1&activeCell=buffer_mensajes!A1\"\n        },\n        \"columnToMatchOn\": \"from\",\n        \"valueToMatchOn\": \"={{$json.from}}\",\n        \"fieldsUi\": {\n          \"values\": [\n            {\n              \"column\": \"procesado\",\n              \"fieldValue\": \"true\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.microsoftExcel\",\n      \"typeVersion\": 2.1,\n      \"position\": [\n        2520,\n        40\n      ],\n      \"id\": \"a26ad9fb-e069-4559-9338-e73a2fd94bf6\",\n      \"name\": \"Update sheet\",\n      \"credentials\": {\n        \"microsoftExcelOAuth2Api\": {\n          \"id\": \"0BgLamAe7CuNGvED\",\n          \"name\": \"Microsoft Excel account 2\"\n        }\n      }\n    }\n  ],\n  \"connections\": {\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Edit Fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Lookup a column\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Wait\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Switch\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Message a model\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Fields1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Edit Fields1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"HTTP Request\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Edit Fields2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"HTTP Request1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"HTTP Request1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"HTTP Request2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Append rows to table\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Wait\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Lookup a column\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        []\n      ]\n    },\n    \"Edit Fields3\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Append rows to table\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Switch\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Fields2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Edit Fields2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"msg_consol\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Fields3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Edit Fields4\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Edit Fields4\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"HTTP Request3\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"msg_consol\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"msg_agrupado\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"msg_agrupado\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update sheet\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Update sheet\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Message a model\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  },\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"staticData\": null,\n  \"meta\": {\n    \"templateCredsSetupCompleted\": true\n  },\n  \"pinData\": {},\n  \"versionId\": \"f1252d25-d152-4cf4-ad8c-e66e3a671dda\",\n  \"triggerCount\": 1,\n  \"tags\": [\n    {\n      \"createdAt\": \"2025-06-03T20:36:49.469Z\",\n      \"updatedAt\": \"2025-06-03T20:36:49.469Z\",\n      \"id\": \"E9oSeWOtAViNQ19X\",\n      \"name\": \"Inverlink\"\n    }\n  ]\n}"
}