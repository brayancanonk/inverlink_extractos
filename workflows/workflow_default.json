{
  "fileName": "Inverlink___Flujo_extracci_n_de_facturas_conexi_n.json",
  "fileContent": "{\n  \"createdAt\": \"2025-07-09T03:14:03.643Z\",\n  \"updatedAt\": \"2025-07-14T20:19:30.339Z\",\n  \"id\": \"9f14rntFhRymmjdF\",\n  \"name\": \"Inverlink - Flujo extracción de facturas conexión\",\n  \"active\": false,\n  \"isArchived\": true,\n  \"nodes\": [\n    {\n      \"parameters\": {},\n      \"type\": \"n8n-nodes-base.manualTrigger\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -1400,\n        -160\n      ],\n      \"id\": \"3b1dc1b2-3bc4-4936-86b0-753eadf994d4\",\n      \"name\": \"When clicking ‘Execute workflow’\"\n    },\n    {\n      \"parameters\": {\n        \"url\": \"https://graph.microsoft.com/v1.0/drives/b!PU0gxZ5Z3U2p8sh5AytDNQ0r9LElzUdKoJM90a8dwlNNksuuoU34TpjRp8lz1oPs/root:/REGISTRO%20OPERACIONES%20HELISA(%20Inverlink%20-IEI-%20IIA)/A%C3%91O%202025/INVERLINK%20SAS/c.%20Tarjetas%20de%20Cr%C3%A9dito/01.%20Enero:/children\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"oAuth2Api\",\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            }\n          ]\n        },\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"responseFormat\": \"json\"\n            }\n          }\n        }\n      },\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.2,\n      \"position\": [\n        -1180,\n        -160\n      ],\n      \"id\": \"fb7d3510-42eb-4900-97e2-5a61aa9c7e99\",\n      \"name\": \"Listar archivos2\",\n      \"credentials\": {\n        \"microsoftSharePointOAuth2Api\": {\n          \"id\": \"NvLfWW6CpSEbWCIO\",\n          \"name\": \"Microsoft SharePoint account\"\n        },\n        \"microsoftGraphSecurityOAuth2Api\": {\n          \"id\": \"3bJKtXRc91GFo2Tj\",\n          \"name\": \"Microsoft Graph Security account\"\n        },\n        \"oAuth2Api\": {\n          \"id\": \"iCNVrjz2iccszU7h\",\n          \"name\": \"Inverlink sharepoint\"\n        }\n      }\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// Obtener todos los datos de entrada\\nconst todosLosItems = $input.all();\\n\\n// Extraer automáticamente los meses válidos desde los datos\\nconst mesesValidos = new Set();\\nfor (const item of todosLosItems) {\\n  const carpetas = item.json.value;\\n  if (!Array.isArray(carpetas)) continue;\\n\\n  for (const carpeta of carpetas) {\\n    const mes = carpeta.parentReference?.name;\\n    if (mes) mesesValidos.add(mes);\\n  }\\n}\\n\\n// Creamos una lista de salida más útil para n8n\\nconst salidaFinal = [];\\n\\nfor (const item of todosLosItems) {\\n  const carpetas = item.json.value;\\n  if (!Array.isArray(carpetas)) continue;\\n\\n  for (const carpeta of carpetas) {\\n    const esCarpeta = carpeta.hasOwnProperty(\\\"folder\\\");\\n    const nombreMes = carpeta.parentReference?.name;\\n    const nombreCarpeta = carpeta.name;\\n\\n    if (esCarpeta && nombreMes && nombreCarpeta && mesesValidos.has(nombreMes)) {\\n      salidaFinal.push({\\n        mes: nombreMes,\\n        banco: nombreCarpeta\\n      });\\n    }\\n  }\\n}\\n\\nreturn salidaFinal.map(entry => ({ json: entry }));\\n\"\n      },\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        -1000,\n        -160\n      ],\n      \"id\": \"1cc5470a-7032-4980-95f1-75bc52bbb45e\",\n      \"name\": \"Extraer folder banco\"\n    },\n    {\n      \"parameters\": {\n        \"conditions\": {\n          \"options\": {\n            \"caseSensitive\": true,\n            \"leftValue\": \"\",\n            \"typeValidation\": \"strict\",\n            \"version\": 2\n          },\n          \"conditions\": [\n            {\n              \"id\": \"d8934554-a0d9-46a7-b4c8-32ee645cfad7\",\n              \"leftValue\": \"={{ $json.banco }}\",\n              \"rightValue\": \"Bancolombia\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"equals\",\n                \"name\": \"filter.operator.equals\"\n              }\n            },\n            {\n              \"id\": \"ad340478-6848-46d7-b1fc-3b021920ce36\",\n              \"leftValue\": \"={{ $json.banco }}\",\n              \"rightValue\": \"=Occidente\",\n              \"operator\": {\n                \"type\": \"string\",\n                \"operation\": \"equals\",\n                \"name\": \"filter.operator.equals\"\n              }\n            }\n          ],\n          \"combinator\": \"or\"\n        },\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.if\",\n      \"typeVersion\": 2.2,\n      \"position\": [\n        -800,\n        -160\n      ],\n      \"id\": \"de5cbebc-81ac-4072-8e1b-83b9855ad530\",\n      \"name\": \"If1\"\n    },\n    {\n      \"parameters\": {\n        \"url\": \"=https://graph.microsoft.com/v1.0/drives/b!PU0gxZ5Z3U2p8sh5AytDNQ0r9LElzUdKoJM90a8dwlNNksuuoU34TpjRp8lz1oPs/root:/REGISTRO%20OPERACIONES%20HELISA(%20Inverlink%20-IEI-%20IIA)/A%C3%91O%202025/INVERLINK%20SAS/c.%20Tarjetas%20de%20Cr%C3%A9dito/01.%20Enero/{{ $json.banco }}:/children\\n\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"oAuth2Api\",\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            }\n          ]\n        },\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"responseFormat\": \"json\"\n            }\n          }\n        }\n      },\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.2,\n      \"position\": [\n        -560,\n        -180\n      ],\n      \"id\": \"cf18daf6-463b-4177-9465-0626801b353e\",\n      \"name\": \"Listar archivos5\",\n      \"credentials\": {\n        \"microsoftSharePointOAuth2Api\": {\n          \"id\": \"NvLfWW6CpSEbWCIO\",\n          \"name\": \"Microsoft SharePoint account\"\n        },\n        \"microsoftGraphSecurityOAuth2Api\": {\n          \"id\": \"3bJKtXRc91GFo2Tj\",\n          \"name\": \"Microsoft Graph Security account\"\n        },\n        \"oAuth2Api\": {\n          \"id\": \"iCNVrjz2iccszU7h\",\n          \"name\": \"Inverlink sharepoint\"\n        }\n      }\n    },\n    {\n      \"parameters\": {\n        \"fieldToSplitOut\": \"value\",\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -380,\n        -180\n      ],\n      \"id\": \"f32be3c7-4c86-4e8f-bd50-841ea5670ad4\",\n      \"name\": \"Split Out\"\n    },\n    {\n      \"parameters\": {\n        \"fieldToSplitOut\": \"value\",\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -980,\n        40\n      ],\n      \"id\": \"a68feca0-568d-4e35-a154-425275f3b5c0\",\n      \"name\": \"Split Out1\",\n      \"executeOnce\": false\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"const items = $input.all(); // Obtener todos los ítems de entrada\\n\\nconst resultado = [];\\n\\nfor (const item of items) {\\n  const json = item.json;\\n\\n  if (json.parentReference?.driveType === \\\"documentLibrary\\\" && json.name) {\\n    resultado.push({ name: json.name });\\n  }\\n}\\n\\nreturn resultado.map(entry => ({ json: entry }));\\n\"\n      },\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        -160,\n        -180\n      ],\n      \"id\": \"3bfd749e-14e7-4cca-b4a4-5e8efc3400fa\",\n      \"name\": \"Code\"\n    },\n    {\n      \"parameters\": {\n        \"url\": \"=https://graph.microsoft.com/v1.0/drives/b!PU0gxZ5Z3U2p8sh5AytDNQ0r9LElzUdKoJM90a8dwlNNksuuoU34TpjRp8lz1oPs/root:/REGISTRO%20OPERACIONES%20HELISA(%20Inverlink%20-IEI-%20IIA)/A%C3%91O%202025/INVERLINK%20SAS/c.%20Tarjetas%20de%20Cr%C3%A9dito/01.%20Enero/{{ $('If1').item.json.banco }}/{{ $json.name }}:/children\\n\",\n        \"authentication\": \"genericCredentialType\",\n        \"genericAuthType\": \"oAuth2Api\",\n        \"sendHeaders\": true,\n        \"headerParameters\": {\n          \"parameters\": [\n            {\n              \"name\": \"Content-Type\",\n              \"value\": \"application/json\"\n            }\n          ]\n        },\n        \"options\": {\n          \"response\": {\n            \"response\": {\n              \"responseFormat\": \"json\"\n            }\n          }\n        }\n      },\n      \"type\": \"n8n-nodes-base.httpRequest\",\n      \"typeVersion\": 4.2,\n      \"position\": [\n        40,\n        -160\n      ],\n      \"id\": \"b35a0c5f-29d4-43d3-8bf6-b63e084ec375\",\n      \"name\": \"Listar archivos\",\n      \"credentials\": {\n        \"microsoftSharePointOAuth2Api\": {\n          \"id\": \"NvLfWW6CpSEbWCIO\",\n          \"name\": \"Microsoft SharePoint account\"\n        },\n        \"microsoftGraphSecurityOAuth2Api\": {\n          \"id\": \"3bJKtXRc91GFo2Tj\",\n          \"name\": \"Microsoft Graph Security account\"\n        },\n        \"oAuth2Api\": {\n          \"id\": \"iCNVrjz2iccszU7h\",\n          \"name\": \"Inverlink sharepoint\"\n        }\n      }\n    },\n    {\n      \"parameters\": {\n        \"fieldToSplitOut\": \"value\",\n        \"options\": {}\n      },\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"typeVersion\": 1,\n      \"position\": [\n        260,\n        -140\n      ],\n      \"id\": \"2f22fe81-e85b-470f-843f-d3c4ae3ca95e\",\n      \"name\": \"Split Out2\"\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"const items = $input.all(); // Obtener todos los ítems de entrada\\n\\nconst resultado = [];\\n\\nfor (const item of items) {\\n  const json = item.json;\\n\\n  if (json.file?.mimeType === \\\"application/pdf\\\" && json.name) {\\n    resultado.push({\\n      name: json.name,\\n      urlDownload: json[\\\"@microsoft.graph.downloadUrl\\\"]\\n    });\\n  }\\n}\\n\\nreturn resultado.map(entry => ({ json: entry }));\\n\"\n      },\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        500,\n        -20\n      ],\n      \"id\": \"8db548d5-d16b-4fd4-81fc-8ed2171d6ea1\",\n      \"name\": \"Code1\"\n    }\n  ],\n  \"connections\": {\n    \"When clicking ‘Execute workflow’\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Listar archivos2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Listar archivos2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Extraer folder banco\",\n            \"type\": \"main\",\n            \"index\": 0\n          },\n          {\n            \"node\": \"Split Out1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Extraer folder banco\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"If1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"If1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Listar archivos5\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Listar archivos5\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Out\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Out\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Code\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Code\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Listar archivos\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Listar archivos\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Out2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Out2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Code1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  },\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"staticData\": null,\n  \"meta\": {\n    \"templateCredsSetupCompleted\": true\n  },\n  \"pinData\": {},\n  \"versionId\": \"8f913e71-04bd-471f-8c09-16269ae36e30\",\n  \"triggerCount\": 0,\n  \"tags\": [\n    {\n      \"createdAt\": \"2025-06-03T20:36:49.469Z\",\n      \"updatedAt\": \"2025-06-03T20:36:49.469Z\",\n      \"id\": \"E9oSeWOtAViNQ19X\",\n      \"name\": \"Inverlink\"\n    },\n    {\n      \"createdAt\": \"2025-06-21T20:39:27.636Z\",\n      \"updatedAt\": \"2025-06-21T20:39:27.636Z\",\n      \"id\": \"XxrfLEy8SmG2KtL4\",\n      \"name\": \"OCR\"\n    },\n    {\n      \"createdAt\": \"2025-06-21T20:39:27.639Z\",\n      \"updatedAt\": \"2025-06-21T20:39:27.639Z\",\n      \"id\": \"wClzvw7IdVzfaWq7\",\n      \"name\": \"Claude\"\n    }\n  ]\n}"
}