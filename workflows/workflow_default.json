{
  "fileName": "Accounting_Records_v3___3__ReteFuente___ReteIVA.json",
  "fileContent": "{\n  \"createdAt\": \"2024-10-23T22:22:30.314Z\",\n  \"updatedAt\": \"2025-06-17T20:56:14.443Z\",\n  \"id\": \"DLHN7DyWE9GlU2dQ\",\n  \"name\": \"Accounting Records v3 - 3. ReteFuente - ReteIVA\",\n  \"active\": true,\n  \"isArchived\": false,\n  \"nodes\": [\n    {\n      \"parameters\": {\n        \"content\": \"# Parametrización del Modelo\\n\\n### - Cargue parámetros para el modelo AI y prompts\\n### - Listado facturas disponibles para procesar\\n\\n\\n\",\n        \"height\": 735.8256129947246,\n        \"width\": 1353.156444372109,\n        \"color\": 7\n      },\n      \"id\": \"d2a4cec6-30ca-49e7-b9de-4956d42963c8\",\n      \"name\": \"Sticky Note4\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -6580,\n        820\n      ]\n    },\n    {\n      \"parameters\": {\n        \"resource\": \"folder\",\n        \"operation\": \"search\",\n        \"query\": \"01PHCLF5GSSTYCRT6MRNA3L2W7QU3UPEA5\"\n      },\n      \"id\": \"eaaee40f-44d6-49d2-ac3a-f17e4c9b5ee2\",\n      \"name\": \"Microsoft OneDrive\",\n      \"type\": \"n8n-nodes-base.microsoftOneDrive\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -6320,\n        1380\n      ],\n      \"credentials\": {\n        \"microsoftOneDriveOAuth2Api\": {\n          \"id\": \"VuffFQLziQK9I5pc\",\n          \"name\": \"Microsoft Drive account\"\n        }\n      }\n    },\n    {\n      \"parameters\": {\n        \"content\": \"# Revisión Responsabilidad ReteFuente\\n\\n### - Revisa la data en la data del flujo el item \\\"TaxLevelCode\\\", toma el código y lo compara con la base en SupaBase con el mismo nombre.\\n### - Revisa el código y trae el nombre del régimen para el tercero.\\n\",\n        \"height\": 1191.4365458325947,\n        \"width\": 588.3196106722916,\n        \"color\": 7\n      },\n      \"id\": \"a31ff0ff-a89d-4050-9c02-3843e0a11cab\",\n      \"name\": \"Sticky Note7\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -5180,\n        360\n      ]\n    },\n    {\n      \"parameters\": {\n        \"content\": \"# Liquidación  ReteFuente\\n\\n### - Revisa la data para confirmar que la ciudad en la que se genera la factura no es la misma que la ciudad en que esta registrado el comprador. Sí es así, no debe tener ReteICA.\\n### - Después de revisar la ciudad, valida la base de datos de la actividad del generador, junto con la descripción de la factura para confirmar si aplica o no alguna retención. \\n### - Si no es autorretenedor se aplica retención en la fuente.\",\n        \"height\": 1181.3770083864347,\n        \"width\": 2289.583178118439,\n        \"color\": 7\n      },\n      \"id\": \"84cc694a-6350-41b9-b319-5f7bb818e4a7\",\n      \"name\": \"Sticky Note8\",\n      \"type\": \"n8n-nodes-base.stickyNote\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -4540,\n        380\n      ]\n    },\n    {\n      \"parameters\": {\n        \"operation\": \"search\",\n        \"base\": {\n          \"__rl\": true,\n          \"value\": \"appxDB6mSqj7XDzIC\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"InvoiceData\",\n          \"cachedResultUrl\": \"https://airtable.com/appxDB6mSqj7XDzIC\"\n        },\n        \"table\": {\n          \"__rl\": true,\n          \"value\": \"tblPHIUqpr9gmLfZJ\",\n          \"mode\": \"list\",\n          \"cachedResultName\": \"AIModels_Prompts\",\n          \"cachedResultUrl\": \"https://airtable.com/appxDB6mSqj7XDzIC/tblPHIUqpr9gmLfZJ\"\n        },\n        \"filterByFormula\": \"ActualProject = \\\"Accounting Records\\\"\",\n        \"options\": {},\n        \"sort\": {\n          \"property\": [\n            {\n              \"field\": \"ID\"\n            }\n          ]\n        }\n      },\n      \"id\": \"2a71eff7-c97a-4c3d-8800-09e04a9e76e4\",\n      \"name\": \"AI_Variables\",\n      \"type\": \"n8n-nodes-base.airtable\",\n      \"typeVersion\": 2.1,\n      \"position\": [\n        -6320,\n        1060\n      ],\n      \"executeOnce\": true,\n      \"credentials\": {\n        \"airtableTokenApi\": {\n          \"id\": \"qt2DSN1Xi7hBivEb\",\n          \"name\": \"Airtable Personal Access Token\"\n        }\n      },\n      \"notes\": \"Parametrización modelos AI y Prompts\"\n    },\n    {\n      \"parameters\": {\n        \"operation\": \"getAll\",\n        \"tableId\": \"Retefuente_TAX\",\n        \"returnAll\": true,\n        \"filterType\": \"none\"\n      },\n      \"id\": \"4bf8e2c0-b66d-496d-9041-a4c835053b33\",\n      \"name\": \"Tablas ReteFuente\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -6140,\n        1060\n      ],\n      \"alwaysOutputData\": true,\n      \"executeOnce\": true,\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"U4Lx0acH9rOsOwsN\",\n          \"name\": \"Supabase InvoiceData\"\n        }\n      },\n      \"notes\": \"Parametrización Retención en la Fuente\"\n    },\n    {\n      \"parameters\": {\n        \"aggregate\": \"aggregateAllItemData\",\n        \"options\": {}\n      },\n      \"id\": \"1bb6b4b4-0d1b-4126-b3ff-a65c52d31814\",\n      \"name\": \"Parametrizacion ReteFuente\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -5960,\n        1060\n      ],\n      \"executeOnce\": false\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"aaf1aed6-347b-4119-a406-9c3f6dab2339\",\n              \"name\": \"Parametros ReteFuente\",\n              \"value\": \"={{ $json.data }}\",\n              \"type\": \"array\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"id\": \"03c91150-6657-4660-95e7-40824799d915\",\n      \"name\": \"Parametros ReteFuente\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        -5780,\n        1060\n      ],\n      \"executeOnce\": true\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"8b565e93-0a7f-47f7-a8f1-4be3d0e53e79\",\n              \"name\": \"Description\",\n              \"value\": \"={{ $json.ItemDescription }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"b725ac85-a5d3-4c76-93cd-96d620eb8be1\",\n              \"name\": \"Quantity\",\n              \"value\": \"={{ $json.Quantity }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"c8b2252d-e993-4302-b8f7-fd101a0c5697\",\n              \"name\": \"Unit_Value\",\n              \"value\": \"={{ $json.Unit_Value }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"6944de35-3853-4574-91e5-0d5ac8ec3a94\",\n              \"name\": \"Total_Value\",\n              \"value\": \"={{ $json.Total_Value }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"46d5c056-baf4-47a8-a3d2-e37be4c52256\",\n              \"name\": \"ParentDocumentID\",\n              \"value\": \"={{ $json.ParentDocumentID }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"df4f99dd-5312-44dc-bd8d-60ddc8031f51\",\n              \"name\": \"SenderParty_CompanyID\",\n              \"value\": \"={{ $json.SenderParty_CompanyID }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"8622e1c2-58cd-4047-a237-43fc7c4c7832\",\n              \"name\": \"SenderParty_RegistrationName\",\n              \"value\": \"={{ $json.SenderParty_RegistrationName }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"b1c50f7d-12f9-47fa-99bc-9c34f5cc7fbf\",\n              \"name\": \"SenderParty_TaxLevelCode\",\n              \"value\": \"={{ $json.SenderParty_TaxLevelCode }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"b727f6a4-27f2-4bc6-802a-92b3ad12cef1\",\n              \"name\": \"Item_uuid\",\n              \"value\": \"={{ $json.Item_uuid }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"19e0a91f-4632-4d54-a3e6-7a1c24eb82c7\",\n              \"name\": \"Invoice_uuid\",\n              \"value\": \"={{ $json.Invoice_uuid }}\",\n              \"type\": \"string\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"id\": \"bac71c36-f8f6-4e85-9402-d396e5e64722\",\n      \"name\": \"Edit Fields\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        -4460,\n        1340\n      ],\n      \"notesInFlow\": true,\n      \"notes\": \"Prepara toda los items de la factura para clasificar por Producto o Servicio\"\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// Initialize an empty array to store the results\\nlet result = [];\\n\\n// Loop through each item in the input\\nfor (let i = 0; i < this.items.length; i++) {\\n  // Get the ExpenseType from the current item in \\\"Invoice Description1\\\"\\n  const expenseType = this.items[i].json.choices[0].message.content.ExpenseType;\\n\\n  // Get the Parametros ReteFuente data (this data is expected to be static across all items)\\n  const parametrosReteFuente = $node[\\\"Parametros ReteFuente\\\"].json['Parametros ReteFuente'];\\n\\n  // Ensure data exists before proceeding\\n  if (!expenseType || !parametrosReteFuente) {\\n    throw new Error(`Required data missing from Invoice Description1 or Parametros ReteFuente nodes for item ${i}`);\\n  }\\n\\n  // Filter the Parametros ReteFuente data based on the ExpenseType\\n  const filteredData = parametrosReteFuente.filter(item => item.CATEGORY === expenseType);\\n\\n  // Extract unique \\\"TYPE\\\" values\\n  const uniqueTypes = [...new Set(filteredData.map(item => item.TYPE))];\\n\\n  // Push the result for the current item into the result array\\n  result.push({\\n    json: {\\n      uniqueTypes: uniqueTypes\\n    }\\n  });\\n}\\n// Return the results for all items\\nreturn result;\\n\"\n      },\n      \"id\": \"3d1a7ff3-ee5d-41d0-9336-0033b1dac72c\",\n      \"name\": \"ReteFuente_Filtrado_Type\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        -3980,\n        1300\n      ],\n      \"notes\": \"Filtra el type según la clasificación de la categoría.\"\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// Retrieve the data from the 'Item Type' node (assumed to be an array of items)\\nconst itemTypeData = $input.all(); // Fetches all the input items from the \\\"Item Type\\\" node\\nconst paramData = $node[\\\"Parametros ReteFuente\\\"].json[\\\"Parametros ReteFuente\\\"];\\n\\n// Prepare an empty array to store the final result\\nlet finalResult = [];\\n\\n// Loop through each item in the 'Item Type' node\\nitemTypeData.forEach(item => {\\n  const typeValue = item.json.choices[0].message.content.Type;\\n  \\n  // Filter the 'Parametros ReteFuente' data based on the 'Type' value from 'Item Type'\\n  const filteredData = paramData.filter(param => param.TYPE === typeValue);\\n  \\n  // Collect 'NUM' and 'CONCEPT' for the current itemType\\n  const numAndConcept = filteredData.map(param => {\\n    return {\\n      NUM: param.NUM,\\n      CONCEPT: param.CONCEPT\\n    };\\n  });\\n  \\n  // Add this filtered list (numAndConcept) to the final result\\n  finalResult.push({\\n    itemType: typeValue,\\n    results: numAndConcept // Array of filtered 'NUM' and 'CONCEPT' objects\\n  });\\n});\\n\\n// Return the result, one list for each input item\\nreturn finalResult;\\n\"\n      },\n      \"id\": \"f8887425-b2ee-47dc-8ede-40187aeb62bb\",\n      \"name\": \"ReteFuente_Filtrado_Concept\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        -3500,\n        1280\n      ],\n      \"notes\": \"Filtra el type según la clasificación de la categoría.\"\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// Retrieve all input data from the node\\nconst allInputData = $input.all(); // Fetches all the input items\\nconst paramData = $node[\\\"Parametros ReteFuente\\\"].json?.[\\\"Parametros ReteFuente\\\"]; // Safely get Parametros ReteFuente\\n\\nif (!paramData) {\\n  // Handle case where Parametros ReteFuente is not found\\n  throw new Error(\\\"No data found in 'Parametros ReteFuente'\\\");\\n}\\n\\n// Prepare an empty array to store the final result for each input\\nlet finalResult = [];\\n\\n// Loop through each input item and process it individually\\nallInputData.forEach(item => {\\n  // Safely extract the 'Num' from 'Item Concept', handling cases where it might be undefined\\n  const itemConcept = $node[\\\"Item Concept\\\"].json?.choices?.[0]?.message?.content?.NUM;\\n\\n  if (!itemConcept) {\\n    // If 'Num' is not found, return an error message for this input\\n    finalResult.push({\\n      json: {\\n        message: \\\"No 'NUM' found in 'Item Concept'.\\\",\\n        item: item.json\\n      }\\n    });\\n    return; // Skip this iteration and move to the next item\\n  }\\n\\n  const itemConceptNum = String(itemConcept); // Convert 'Num' to a string\\n\\n  // Filter the 'Parametros ReteFuente' data based on the 'Num' from 'Item Concept'\\n  const filteredData = paramData.find(param => String(param.NUM) === itemConceptNum);\\n\\n  if (filteredData) {\\n    // Convert the 'TARIFA' string to a float and store it in a variable called 'Tariff'\\n    const tariff = parseFloat(filteredData.TARIFA);\\n\\n    // Push the result for this particular input item\\n    finalResult.push({\\n      json: {\\n        Tariff: tariff,\\n        NUM: filteredData.NUM,\\n        CONCEPT: filteredData.CONCEPT\\n      }\\n    });\\n  } else {\\n    // Handle case if no matching 'Num' is found in 'Parametros ReteFuente' for this input item\\n    finalResult.push({\\n      json: {\\n        message: \\\"No matching NUM found for this input item.\\\",\\n        NUM: itemConceptNum\\n      }\\n    });\\n  }\\n});\\n\\n// Return the final result, ensuring one output per input item\\nreturn finalResult;\\n\"\n      },\n      \"id\": \"14e39f60-551b-4e1b-ae8a-f53b8871f34b\",\n      \"name\": \"ReteFuente_Value\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        -3100,\n        1260\n      ]\n    },\n    {\n      \"parameters\": {\n        \"fieldToSplitOut\": \"Items\",\n        \"options\": {}\n      },\n      \"id\": \"88cdec4b-b4c1-4486-aae3-00dcb946c7b0\",\n      \"name\": \"Split Items\",\n      \"type\": \"n8n-nodes-base.splitOut\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -5360,\n        1060\n      ]\n    },\n    {\n      \"parameters\": {\n        \"modelId\": {\n          \"__rl\": true,\n          \"value\": \"={{ $item(3).$node[\\\"AI_Variables\\\"].json[\\\"ActualModel\\\"] }}\",\n          \"mode\": \"id\"\n        },\n        \"messages\": {\n          \"values\": [\n            {\n              \"content\": \"={{ $item(3).$node[\\\"AI_Variables\\\"].json[\\\"SystemPrompt\\\"] }}\",\n              \"role\": \"system\"\n            },\n            {\n              \"content\": \"={{ $item(3).$node[\\\"AI_Variables\\\"].json[\\\"UserPrompt_1\\\"] }}\"\n            },\n            {\n              \"content\": \"={{ $item(3).$node[\\\"AI_Variables\\\"].json[\\\"UserPrompt_2\\\"] }}\"\n            },\n            {\n              \"content\": \"={{ $item(3).$node[\\\"AI_Variables\\\"].json[\\\"UserPrompt_3\\\"] }}\"\n            },\n            {\n              \"content\": \"={{ $item(3).$node[\\\"AI_Variables\\\"].json[\\\"UserPrompt_4\\\"] }}\"\n            },\n            {\n              \"content\": \"=Item Description\\n{{ $json.Description }}\\n{{ $json.SenderParty_RegistrationName }}\"\n            }\n          ]\n        },\n        \"simplify\": false,\n        \"jsonOutput\": true,\n        \"options\": {\n          \"maxTokens\": 4096,\n          \"temperature\": \"={{ $item(3).$node[\\\"AI_Variables\\\"].json[\\\"Temperature\\\"] }}\"\n        }\n      },\n      \"id\": \"3f750fe4-e545-42dd-b407-0492baea35d4\",\n      \"name\": \"Item Category\",\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"typeVersion\": 1.4,\n      \"position\": [\n        -4240,\n        1320\n      ],\n      \"alwaysOutputData\": true,\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"0r1L7QIDC5ZRtM0r\",\n          \"name\": \"OpenAi\"\n        }\n      },\n      \"onError\": \"continueErrorOutput\"\n    },\n    {\n      \"parameters\": {\n        \"modelId\": {\n          \"__rl\": true,\n          \"value\": \"={{ $item(4).$node[\\\"AI_Variables\\\"].json[\\\"ActualModel\\\"] }}\",\n          \"mode\": \"id\"\n        },\n        \"messages\": {\n          \"values\": [\n            {\n              \"content\": \"={{ $item(4).$node[\\\"AI_Variables\\\"].json[\\\"SystemPrompt\\\"] }}\",\n              \"role\": \"system\"\n            },\n            {\n              \"content\": \"={{ $item(4).$node[\\\"AI_Variables\\\"].json[\\\"UserPrompt_1\\\"] }}\"\n            },\n            {\n              \"content\": \"={{ $item(4).$node[\\\"AI_Variables\\\"].json[\\\"UserPrompt_2\\\"] }}\"\n            },\n            {\n              \"content\": \"={{ $item(4).$node[\\\"AI_Variables\\\"].json[\\\"UserPrompt_3\\\"] }}\"\n            },\n            {\n              \"content\": \"={{ $item(4).$node[\\\"AI_Variables\\\"].json[\\\"UserPrompt_4\\\"] }}\"\n            },\n            {\n              \"content\": \"=Item Description\\n{{ $('Edit Fields').item.json.Description }}\\n\\nType List\\n{{ $json.uniqueTypes }}\"\n            }\n          ]\n        },\n        \"simplify\": false,\n        \"jsonOutput\": true,\n        \"options\": {\n          \"maxTokens\": 4096,\n          \"temperature\": \"={{ $item(4).$node[\\\"AI_Variables\\\"].json[\\\"Temperature\\\"] }}\"\n        }\n      },\n      \"id\": \"b1e64e9b-4820-4bf8-a5d6-ba2d7f587316\",\n      \"name\": \"Item Type\",\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"typeVersion\": 1.4,\n      \"position\": [\n        -3760,\n        1300\n      ],\n      \"alwaysOutputData\": true,\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"0r1L7QIDC5ZRtM0r\",\n          \"name\": \"OpenAi\"\n        }\n      },\n      \"onError\": \"continueErrorOutput\"\n    },\n    {\n      \"parameters\": {\n        \"options\": {}\n      },\n      \"id\": \"9e4c0f54-2456-4a2c-ba7d-3e483085b3ca\",\n      \"name\": \"Loop Over Items\",\n      \"type\": \"n8n-nodes-base.splitInBatches\",\n      \"typeVersion\": 3,\n      \"position\": [\n        -4860,\n        1300\n      ]\n    },\n    {\n      \"parameters\": {\n        \"modelId\": {\n          \"__rl\": true,\n          \"value\": \"={{ $item(5).$node[\\\"AI_Variables\\\"].json[\\\"ActualModel\\\"] }}\",\n          \"mode\": \"id\"\n        },\n        \"messages\": {\n          \"values\": [\n            {\n              \"content\": \"={{ $item(5).$node[\\\"AI_Variables\\\"].json[\\\"SystemPrompt\\\"] }}\",\n              \"role\": \"system\"\n            },\n            {\n              \"content\": \"={{ $item(5).$node[\\\"AI_Variables\\\"].json[\\\"UserPrompt_1\\\"] }}\"\n            },\n            {\n              \"content\": \"={{ $item(5).$node[\\\"AI_Variables\\\"].json[\\\"UserPrompt_2\\\"] }}\"\n            },\n            {\n              \"content\": \"={{ $item(5).$node[\\\"AI_Variables\\\"].json[\\\"UserPrompt_3\\\"] }}\"\n            },\n            {\n              \"content\": \"={{ $item(5).$node[\\\"AI_Variables\\\"].json[\\\"UserPrompt_4\\\"] }}\"\n            },\n            {\n              \"content\": \"=# INPUT INFORMATION\\n\\nItem Description\\n{{ $('Edit Fields').item.json.Description }}\\n\\nItem Category\\n{{ $('Item Category').item.json.choices[0].message.content.ExpenseType }}\\n\\nItem Type\\n{{ $('Item Type').item.json.choices[0].message.content.Type }}\\n\\nConcept List\\nA structured list, each with a \\\"NUM\\\" and \\\"CONCEPT\\\" that you must match to the item description.\\n\\n{{ $json.results.map(result => `NUM: ${result.NUM}, CONCEPT: ${result.CONCEPT}`).join(', ') }}\"\n            }\n          ]\n        },\n        \"simplify\": false,\n        \"jsonOutput\": true,\n        \"options\": {\n          \"maxTokens\": 4096,\n          \"temperature\": \"={{ $item(5).$node[\\\"AI_Variables\\\"].json[\\\"Temperature\\\"] }}\"\n        }\n      },\n      \"id\": \"f53446d1-e280-48dd-a859-84a0c27f1111\",\n      \"name\": \"Item Concept\",\n      \"type\": \"@n8n/n8n-nodes-langchain.openAi\",\n      \"typeVersion\": 1.4,\n      \"position\": [\n        -3300,\n        1280\n      ],\n      \"alwaysOutputData\": true,\n      \"credentials\": {\n        \"openAiApi\": {\n          \"id\": \"0r1L7QIDC5ZRtM0r\",\n          \"name\": \"OpenAi\"\n        }\n      },\n      \"onError\": \"continueErrorOutput\"\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"d9c3d9ba-9ba5-4ddf-b2b5-5a9e341cb485\",\n              \"name\": \"ParentDocumentID\",\n              \"value\": \"={{ $('Edit Fields').item.json.ParentDocumentID }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"b98c17c4-00bf-4eec-9249-0927e649a7e7\",\n              \"name\": \"SenderParty_CompanyID\",\n              \"value\": \"={{ $('Edit Fields').item.json.SenderParty_CompanyID }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"2e6d0125-9d9e-4750-93ce-74920d5f207c\",\n              \"name\": \"SenderParty_RegistrationName\",\n              \"value\": \"={{ $('Edit Fields').item.json.SenderParty_RegistrationName }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"74d3adfb-9f2f-4428-a29b-26cd7bbac4be\",\n              \"name\": \"SenderParty_TaxLevelCode\",\n              \"value\": \"={{ $('Edit Fields').item.json.SenderParty_TaxLevelCode }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"fcc0d00c-0628-4216-8d74-6f7fae970e68\",\n              \"name\": \"ItemDescription\",\n              \"value\": \"={{ $('Edit Fields').item.json.Description }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"bfd808d9-cadf-4ec9-b3a5-2ddf67b4d36a\",\n              \"name\": \"Quantity\",\n              \"value\": \"={{ $('Edit Fields').item.json.Quantity }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"8991e882-5fe7-4521-8489-379c3ecd3390\",\n              \"name\": \"Unit_Value\",\n              \"value\": \"={{ $('Edit Fields').item.json.Unit_Value }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"b57d99e7-7883-433a-94ce-875f65016b54\",\n              \"name\": \"Total_Value\",\n              \"value\": \"={{ $('Edit Fields').item.json.Total_Value }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"80e490e4-ac1e-4bf9-9019-0ceb4c90a002\",\n              \"name\": \"ExpenseType\",\n              \"value\": \"={{ $('Item Category').item.json.choices[0].message.content.ExpenseType }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"7caa3e8c-5883-4a72-b964-9f082682c939\",\n              \"name\": \"Type\",\n              \"value\": \"={{ $('Item Type').item.json.choices[0].message.content.Type }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"d599a55d-95eb-4fbb-a44f-8e1f2991c827\",\n              \"name\": \"Tariff\",\n              \"value\": \"={{ $json.Tariff }}\",\n              \"type\": \"number\"\n            },\n            {\n              \"id\": \"1c5d550b-4213-4e4f-bb04-7e87fbd503ae\",\n              \"name\": \"NUM\",\n              \"value\": \"={{ $json.NUM }}\",\n              \"type\": \"number\"\n            },\n            {\n              \"id\": \"ec72afe2-f8bf-419e-92f4-1164cbd7d6cd\",\n              \"name\": \"ReteFuente_Item_Value\",\n              \"value\": \"={{ $('Edit Fields').item.json.Total_Value * $json.Tariff }}\\n\",\n              \"type\": \"number\"\n            },\n            {\n              \"id\": \"52525cee-1c45-49d1-8fac-3882ba8121f6\",\n              \"name\": \"Item_uuid\",\n              \"value\": \"={{ $('Edit Fields').item.json.Item_uuid }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"48d568b5-ef87-4c69-b072-ed9ed252768c\",\n              \"name\": \"Invoice_uuid\",\n              \"value\": \"={{ $('Edit Fields').item.json.Invoice_uuid }}\",\n              \"type\": \"string\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"id\": \"abebf719-17a0-454a-8cc1-4b74ef8b221d\",\n      \"name\": \"Edit Fields1\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        -2920,\n        1320\n      ]\n    },\n    {\n      \"parameters\": {\n        \"aggregate\": \"aggregateAllItemData\",\n        \"options\": {}\n      },\n      \"id\": \"37ddd1de-248e-41b6-b9ad-8185f7bb5b37\",\n      \"name\": \"Aggregate Items RF\",\n      \"type\": \"n8n-nodes-base.aggregate\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -4440,\n        1060\n      ]\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// Input from \\\"Aggregate Items RF\\\" node\\nconst inputData = $input.all()[0].json.data; \\n\\n// Initialize a result array to store the grouped data\\nlet groupedResults = [];\\n\\n// Helper function to group items by `Invoice_uuid` and `NUM` and sum `Total_Value`\\nfunction groupBy(arr, keys) {\\n  return arr.reduce((acc, item) => {\\n    // Create a unique group key based on the Invoice_uuid and NUM\\n    const groupKey = keys.map(key => item[key]).join('-');\\n\\n    // If the group doesn't exist, initialize it\\n    if (!acc[groupKey]) {\\n      acc[groupKey] = {\\n        Invoice_uuid: item.Invoice_uuid,\\n        NUM: item.NUM,\\n        Total_Item_NUM: 0 // Initialize the total sum of Total_Value\\n      };\\n    }\\n\\n    // Sum up the `Total_Value` for each group\\n    acc[groupKey].Total_Item_NUM += parseFloat(item.Total_Value);\\n\\n    return acc;\\n  }, {});\\n}\\n\\n// Step 1: Group by `Invoice_uuid` and `NUM` and sum `Total_Value`\\nconst groupedData = groupBy(inputData, ['Invoice_uuid', 'NUM']);\\n\\n// Convert the grouped object into an array of results\\nfor (const groupKey in groupedData) {\\n  groupedResults.push(groupedData[groupKey]);\\n}\\n\\n// Return the result as an array of objects\\nreturn groupedResults.map(group => ({ json: group }));\"\n      },\n      \"id\": \"4078dc21-54b4-49ef-a4cf-a64834b24797\",\n      \"name\": \"Subtotal_Invoice_NUM\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        -4220,\n        1060\n      ]\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// Retrieve data from the \\\"Subtotal_Invoice_NUM\\\" node\\nconst subtotalData = $input.all(); \\n\\n// Retrieve \\\"Parametros ReteFuente\\\" data with explicit structure access\\nconst parametrosReteFuenteNode = $node['Parametros ReteFuente'];\\nconst parametrosReteFuenteData = parametrosReteFuenteNode ? parametrosReteFuenteNode.json['Parametros ReteFuente'] : null;\\n\\n// Check if \\\"Parametros ReteFuente\\\" data is available\\nif (!parametrosReteFuenteData) {\\n  // Output an error message and available node data for debugging\\n  throw new Error(\\\"Parametros ReteFuente data is missing. Verify if the node 'Parametros ReteFuente' has run and contains data in 'Parametros_ReteFuente'.\\\");\\n}\\n\\n// Initialize an array to store the final result\\nlet finalResults = [];\\n\\n// Loop through each item in the \\\"Subtotal_Invoice_NUM\\\" data\\nsubtotalData.forEach(item => {\\n  const numValue = item.json.NUM; // Get the \\\"NUM\\\" value\\n\\n  // Step 1: Filter \\\"Parametros ReteFuente\\\" data using \\\"NUM\\\" value\\n  const matchingParam = parametrosReteFuenteData.find(param => param.NUM === numValue);\\n\\n  if (!matchingParam) {\\n    throw new Error(`No matching Parametros ReteFuente found for NUM: ${numValue}`);\\n  }\\n\\n  const basePesos = parseFloat(matchingParam.BASE_PESOS); // Get the \\\"BASE_PESOS\\\" value\\n\\n  // Step 2: Create the \\\"ReteFuente_Liquida\\\" boolean variable\\n  const reteFuenteLiquida = parseFloat(item.json.Total_Item_NUM) >= basePesos;\\n\\n  // Step 3: Add the result for this item to the finalResults array\\n  finalResults.push({\\n    Invoice_uuid: item.json.Invoice_uuid,\\n    NUM: item.json.NUM,\\n    Total_Item_NUM: item.json.Total_Item_NUM,\\n    ReteFuente_Liquida: reteFuenteLiquida\\n  });\\n});\\n\\n// Return the final results\\nreturn finalResults.map(result => ({ json: result }));\\n\\n\\n\\n\"\n      },\n      \"id\": \"628feaed-773e-4384-9190-66b281f65b75\",\n      \"name\": \"Code\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        -4000,\n        1060\n      ]\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// Retrieve data from 'Aggregate Items RF' node\\nconst aggregateItemsData = $node['Aggregate Items RF']?.json?.data || [];\\n\\n// Retrieve data from the 'Code' node\\nlet reteFuenteLiquidaData = $node['Code']?.json || [];\\n\\n// Ensure reteFuenteLiquidaData is always an array, even if it contains a single object\\nif (!Array.isArray(reteFuenteLiquidaData)) {\\n  reteFuenteLiquidaData = [reteFuenteLiquidaData];\\n}\\n\\n// Check if 'Aggregate Items RF' has valid data\\nif (aggregateItemsData.length === 0) {\\n  throw new Error(\\\"No data received from 'Aggregate Items RF'. Verify if the node has valid data.\\\");\\n}\\n\\n// Initialize an array to store the final results\\nlet finalResults = [];\\n\\n// Loop through each item in the 'Aggregate Items RF' data\\naggregateItemsData.forEach(item => {\\n  // Find the matching item in 'Code' node data using 'Invoice_uuid' and 'NUM'\\n  const matchingItem = reteFuenteLiquidaData.find(reteItem => \\n    reteItem.Invoice_uuid === item.Invoice_uuid && reteItem.NUM === item.NUM\\n  );\\n\\n  // Add the 'ReteFuente_Liquida' value to the current item if a match is found\\n  if (matchingItem) {\\n    item.ReteFuente_Liquida = matchingItem.ReteFuente_Liquida;\\n  } else {\\n    // If no match is found, set the default value for 'ReteFuente_Liquida' as false\\n    item.ReteFuente_Liquida = false;\\n  }\\n\\n  // Push the modified item with all required fields to the final results\\n  finalResults.push({\\n    ParentDocumentID: item.ParentDocumentID,\\n    SenderParty_CompanyID: item.SenderParty_CompanyID,\\n    SenderParty_RegistrationName: item.SenderParty_RegistrationName,\\n    SenderParty_TaxLevelCode: item.SenderParty_TaxLevelCode,\\n    ItemDescription: item.ItemDescription,\\n    Quantity: item.Quantity,\\n    Unit_Value: item.Unit_Value,\\n    Total_Value: item.Total_Value,\\n    ExpenseType: item.ExpenseType,\\n    Type: item.Type,\\n    Tariff: item.Tariff,\\n    NUM: item.NUM,\\n    ReteFuente_Liquida: item.ReteFuente_Liquida,\\n    ReteFuente_Item_Value: item.ReteFuente_Item_Value,\\n    Item_uuid: item.Item_uuid,\\n    Invoice_uuid: item.Invoice_uuid\\n  });\\n});\\n\\n// Return the final results as the output of the node\\nreturn finalResults.map(result => ({ json: result }));\"\n      },\n      \"id\": \"fa4359e4-0c87-4242-9449-2d746b506d7c\",\n      \"name\": \"Item_Data_DB\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        -3780,\n        1060\n      ]\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"7f3bb3c7-9d19-463a-9325-9fc3a914ac4d\",\n              \"name\": \"ReteFuente_ExpenseType\",\n              \"value\": \"={{ $json.ExpenseType }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"7133fc2e-7e18-453e-b54e-b855466a5a32\",\n              \"name\": \"ReteFuente_Type\",\n              \"value\": \"={{ $json.Type }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"bee604d7-a841-4382-ba80-4d627b68076f\",\n              \"name\": \"ReteFuente_Tariff\",\n              \"value\": \"={{ $json.Tariff }}\",\n              \"type\": \"number\"\n            },\n            {\n              \"id\": \"41fbae76-0faf-43a7-ba5b-bbc678f1db2b\",\n              \"name\": \"ReteFuente_NUM\",\n              \"value\": \"={{ $json.NUM }}\",\n              \"type\": \"number\"\n            },\n            {\n              \"id\": \"23a44518-a465-4498-9787-177833eb1fe4\",\n              \"name\": \"ReteFuente_Liquida\",\n              \"value\": \"={{ $json.ReteFuente_Liquida }}\",\n              \"type\": \"boolean\"\n            },\n            {\n              \"id\": \"66a0f7dd-acdc-4920-b745-888e52fe6a00\",\n              \"name\": \"ReteFuente_Item_Value\",\n              \"value\": \"={{ $('Item_Data_DB').item.json.Total_Value * $json.Tariff }}\",\n              \"type\": \"number\"\n            },\n            {\n              \"id\": \"59f4524b-6345-453f-8a7d-8379c49591b3\",\n              \"name\": \"Item_uuid\",\n              \"value\": \"={{ $json.Item_uuid }}\",\n              \"type\": \"string\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"id\": \"7a946c8a-6d83-446e-b4be-cd38f246ac34\",\n      \"name\": \"Edit Fields2\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        -3560,\n        1060\n      ]\n    },\n    {\n      \"parameters\": {\n        \"respondWith\": \"allIncomingItems\",\n        \"options\": {}\n      },\n      \"id\": \"8682650b-68d1-46ca-8e62-9896090c2cdb\",\n      \"name\": \"Respond to Webhook\",\n      \"type\": \"n8n-nodes-base.respondToWebhook\",\n      \"typeVersion\": 1.1,\n      \"position\": [\n        -2380,\n        660\n      ]\n    },\n    {\n      \"parameters\": {\n        \"jsCode\": \"// Input data from the previous node\\nconst inputData = $input.all().map(item => item.json);\\n\\n// Step 1: Initialize an empty object to hold the grouped data\\nconst groupedData = {};\\n\\n// Step 2: Group by \\\"Invoice_uuid\\\" and sum \\\"ReteFuente_Item_Value\\\"\\ninputData.forEach(item => {\\n  const invoiceId = item.Invoice_uuid;\\n  \\n  // If the group for this Invoice_uuid doesn't exist, initialize it\\n  if (!groupedData[invoiceId]) {\\n    groupedData[invoiceId] = {\\n      Invoice_uuid: invoiceId,\\n      ReteFuente: 0 // Initialize ReteFuente to 0\\n    };\\n  }\\n  \\n  // Add the \\\"ReteFuente_Item_Value\\\" to the \\\"ReteFuente\\\" total\\n  groupedData[invoiceId].ReteFuente += parseFloat(item.ReteFuente_Item_Value || 0);\\n});\\n\\n// Step 3: Convert the grouped data object to an array of results\\nconst result = Object.values(groupedData);\\n\\n// Return the final result as an array of objects, each containing \\\"Invoice_uuid\\\" and \\\"ReteFuente\\\"\\nreturn result.map(group => ({ json: group }));\"\n      },\n      \"id\": \"280bf612-e754-42fc-b8d2-33fb168c5c48\",\n      \"name\": \"ReteFuente\",\n      \"type\": \"n8n-nodes-base.code\",\n      \"typeVersion\": 2,\n      \"position\": [\n        -3120,\n        1040\n      ]\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"613c54a3-f33c-4c58-a324-9a09d3ac172c\",\n              \"name\": \"Invoice_uuid\",\n              \"value\": \"={{ $json.Invoice_uuid }}\",\n              \"type\": \"string\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"id\": \"ec095913-4d26-4824-ac8a-395391556406\",\n      \"name\": \"Data_ReteIVA\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        -4860,\n        680\n      ]\n    },\n    {\n      \"parameters\": {\n        \"rules\": {\n          \"values\": [\n            {\n              \"conditions\": {\n                \"options\": {\n                  \"caseSensitive\": true,\n                  \"leftValue\": \"\",\n                  \"typeValidation\": \"strict\",\n                  \"version\": 2\n                },\n                \"conditions\": [\n                  {\n                    \"id\": \"34388c4d-ee36-4b53-bd77-9562b2e3b625\",\n                    \"leftValue\": \"={{ $json.SenderParty_TaxLevelCode }}\",\n                    \"rightValue\": \"O-12\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"contains\"\n                    }\n                  }\n                ],\n                \"combinator\": \"and\"\n              },\n              \"renameOutput\": true,\n              \"outputKey\": \"Simple\"\n            },\n            {\n              \"conditions\": {\n                \"options\": {\n                  \"caseSensitive\": true,\n                  \"leftValue\": \"\",\n                  \"typeValidation\": \"strict\",\n                  \"version\": 2\n                },\n                \"conditions\": [\n                  {\n                    \"leftValue\": \"={{ $json.SenderParty_TaxLevelCode }}\",\n                    \"rightValue\": \"O-15\",\n                    \"operator\": {\n                      \"type\": \"string\",\n                      \"operation\": \"contains\"\n                    }\n                  }\n                ],\n                \"combinator\": \"and\"\n              },\n              \"renameOutput\": true,\n              \"outputKey\": \"Autorretenedor\"\n            }\n          ]\n        },\n        \"options\": {\n          \"fallbackOutput\": \"extra\"\n        }\n      },\n      \"id\": \"2cbbf73d-e207-4f6b-a425-99a14851ddb0\",\n      \"name\": \"Switch\",\n      \"type\": \"n8n-nodes-base.switch\",\n      \"typeVersion\": 3.2,\n      \"position\": [\n        -5020,\n        1060\n      ]\n    },\n    {\n      \"parameters\": {\n        \"compare\": \"selectedFields\",\n        \"fieldsToCompare\": \"Invoice_uuid\",\n        \"options\": {}\n      },\n      \"id\": \"a1856b6f-fa9b-4c75-b089-10c432ad54f1\",\n      \"name\": \"Remove Duplicates\",\n      \"type\": \"n8n-nodes-base.removeDuplicates\",\n      \"typeVersion\": 2,\n      \"position\": [\n        -4440,\n        680\n      ]\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"8a97f4a9-ef9d-4af4-a003-829e3dd2842b\",\n              \"name\": \"Invoice_uuid\",\n              \"value\": \"={{ $json.Invoice_uuid }}\",\n              \"type\": \"string\"\n            },\n            {\n              \"id\": \"a6f43e76-c872-49f9-b755-bae56e9961c6\",\n              \"name\": \"ReteIVA\",\n              \"value\": \"={{ ($json.IVA || 0) * 0.15 }}\",\n              \"type\": \"number\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"id\": \"7ff7cfdb-191b-4555-915e-71c0a99fff48\",\n      \"name\": \"Calculo ReteIVA\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        -3920,\n        660\n      ]\n    },\n    {\n      \"parameters\": {},\n      \"id\": \"f8fa75c6-5d48-4dae-8a07-4bae50b92a79\",\n      \"name\": \"No Operation, do nothing\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -4800,\n        880\n      ]\n    },\n    {\n      \"parameters\": {},\n      \"id\": \"0bffc248-98f2-4e36-8a65-7b7d4fef7b09\",\n      \"name\": \"No Operation, do nothing1\",\n      \"type\": \"n8n-nodes-base.noOp\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -2900,\n        880\n      ]\n    },\n    {\n      \"parameters\": {\n        \"assignments\": {\n          \"assignments\": [\n            {\n              \"id\": \"636743ae-91b3-42d6-8f1e-9fde1287c121\",\n              \"name\": \"Items\",\n              \"value\": \"={{ $('Webhook').item.json.body.Items }}\",\n              \"type\": \"array\"\n            }\n          ]\n        },\n        \"options\": {}\n      },\n      \"id\": \"06f92130-31f8-4425-9ff6-742446fcc809\",\n      \"name\": \"Mapping Items\",\n      \"type\": \"n8n-nodes-base.set\",\n      \"typeVersion\": 3.4,\n      \"position\": [\n        -5580,\n        1060\n      ],\n      \"alwaysOutputData\": true\n    },\n    {\n      \"parameters\": {\n        \"operation\": \"update\",\n        \"tableId\": \"InvoicesItems\",\n        \"filters\": {\n          \"conditions\": [\n            {\n              \"keyName\": \"Item_uuid\",\n              \"condition\": \"eq\",\n              \"keyValue\": \"={{ $json.Item_uuid }}\"\n            }\n          ]\n        },\n        \"dataToSend\": \"autoMapInputData\"\n      },\n      \"id\": \"69d909b1-dce9-42cf-b5c4-927165d0c084\",\n      \"name\": \"Items_ReteFuente\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -3340,\n        1060\n      ],\n      \"executeOnce\": false,\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"U4Lx0acH9rOsOwsN\",\n          \"name\": \"Supabase InvoiceData\"\n        }\n      },\n      \"onError\": \"continueErrorOutput\"\n    },\n    {\n      \"parameters\": {\n        \"operation\": \"update\",\n        \"tableId\": \"Accounting_Records\",\n        \"filters\": {\n          \"conditions\": [\n            {\n              \"keyName\": \"Invoice_uuid\",\n              \"condition\": \"eq\",\n              \"keyValue\": \"={{ $json.Invoice_uuid }}\"\n            }\n          ]\n        },\n        \"fieldsUi\": {\n          \"fieldValues\": [\n            {\n              \"fieldId\": \"ReteFuente\",\n              \"fieldValue\": \"={{ $json.ReteFuente }}\"\n            }\n          ]\n        }\n      },\n      \"id\": \"784a96da-738c-4d84-9856-7bc575c71dbf\",\n      \"name\": \"Supabase\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -2900,\n        1040\n      ],\n      \"executeOnce\": false,\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"U4Lx0acH9rOsOwsN\",\n          \"name\": \"Supabase InvoiceData\"\n        }\n      },\n      \"onError\": \"continueErrorOutput\"\n    },\n    {\n      \"parameters\": {\n        \"operation\": \"update\",\n        \"tableId\": \"Accounting_Records\",\n        \"filters\": {\n          \"conditions\": [\n            {\n              \"keyName\": \"Invoice_uuid\",\n              \"condition\": \"eq\",\n              \"keyValue\": \"={{ $json.Invoice_uuid }}\"\n            }\n          ]\n        },\n        \"fieldsUi\": {\n          \"fieldValues\": [\n            {\n              \"fieldId\": \"ReteIVA\",\n              \"fieldValue\": \"={{ $json.ReteIVA }}\"\n            }\n          ]\n        }\n      },\n      \"id\": \"ad9eede3-0869-4565-af91-62d258e6e721\",\n      \"name\": \"Update ReteIVA\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -3620,\n        660\n      ],\n      \"executeOnce\": false,\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"U4Lx0acH9rOsOwsN\",\n          \"name\": \"Supabase InvoiceData\"\n        }\n      },\n      \"onError\": \"continueErrorOutput\"\n    },\n    {\n      \"parameters\": {\n        \"operation\": \"get\",\n        \"tableId\": \"InvoicesData\",\n        \"filters\": {\n          \"conditions\": [\n            {\n              \"keyName\": \"Invoice_uuid\",\n              \"keyValue\": \"={{ $json.Invoice_uuid }}\"\n            }\n          ]\n        }\n      },\n      \"id\": \"060bcf22-4ed3-4618-a942-a5ea880d3018\",\n      \"name\": \"Invoices Data\",\n      \"type\": \"n8n-nodes-base.supabase\",\n      \"typeVersion\": 1,\n      \"position\": [\n        -4220,\n        680\n      ],\n      \"credentials\": {\n        \"supabaseApi\": {\n          \"id\": \"U4Lx0acH9rOsOwsN\",\n          \"name\": \"Supabase InvoiceData\"\n        }\n      },\n      \"onError\": \"continueErrorOutput\"\n    },\n    {\n      \"parameters\": {\n        \"numberInputs\": 3\n      },\n      \"id\": \"457ebf6f-d74c-4e53-bf7a-4ed58e70e598\",\n      \"name\": \"Merge\",\n      \"type\": \"n8n-nodes-base.merge\",\n      \"typeVersion\": 3,\n      \"position\": [\n        -2600,\n        660\n      ]\n    },\n    {\n      \"parameters\": {\n        \"httpMethod\": \"POST\",\n        \"path\": \"723886f9-f152-4182-b775-201b52833438\",\n        \"responseMode\": \"responseNode\",\n        \"options\": {}\n      },\n      \"id\": \"a8085e62-3c59-4733-8a53-5e6a69e3850f\",\n      \"name\": \"Webhook\",\n      \"type\": \"n8n-nodes-base.webhook\",\n      \"typeVersion\": 2,\n      \"position\": [\n        -6520,\n        1060\n      ],\n      \"webhookId\": \"64fdbb24-5120-46d4-908a-3d914adcfb99\"\n    }\n  ],\n  \"connections\": {\n    \"Tablas ReteFuente\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Parametrizacion ReteFuente\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Parametrizacion ReteFuente\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Parametros ReteFuente\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Parametros ReteFuente\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Mapping Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Edit Fields\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Item Category\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ReteFuente_Filtrado_Type\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Item Type\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ReteFuente_Filtrado_Concept\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Item Concept\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Split Items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Switch\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Item Category\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ReteFuente_Filtrado_Type\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Item Type\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ReteFuente_Filtrado_Concept\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Loop Over Items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Aggregate Items RF\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Edit Fields\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Item Concept\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ReteFuente_Value\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ReteFuente_Value\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Fields1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Edit Fields1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Aggregate Items RF\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Subtotal_Invoice_NUM\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Subtotal_Invoice_NUM\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Code\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Code\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Item_Data_DB\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Item_Data_DB\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Edit Fields2\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Edit Fields2\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Items_ReteFuente\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"AI_Variables\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Tablas ReteFuente\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"ReteFuente\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Supabase\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Switch\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Data_ReteIVA\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"No Operation, do nothing\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Loop Over Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Data_ReteIVA\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Remove Duplicates\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Remove Duplicates\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Invoices Data\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Calculo ReteIVA\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Update ReteIVA\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"No Operation, do nothing\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"No Operation, do nothing1\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"No Operation, do nothing1\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 2\n          }\n        ]\n      ]\n    },\n    \"Mapping Items\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Split Items\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Items_ReteFuente\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"ReteFuente\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"ReteFuente\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Update ReteIVA\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ],\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 1\n          }\n        ]\n      ]\n    },\n    \"Invoices Data\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Calculo ReteIVA\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ],\n        [\n          {\n            \"node\": \"Calculo ReteIVA\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Supabase\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Merge\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Merge\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"Respond to Webhook\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    },\n    \"Webhook\": {\n      \"main\": [\n        [\n          {\n            \"node\": \"AI_Variables\",\n            \"type\": \"main\",\n            \"index\": 0\n          }\n        ]\n      ]\n    }\n  },\n  \"settings\": {\n    \"executionOrder\": \"v1\"\n  },\n  \"staticData\": null,\n  \"meta\": {\n    \"templateCredsSetupCompleted\": true\n  },\n  \"pinData\": {},\n  \"versionId\": \"89290f23-1e9f-4cd0-a488-0f417a041a10\",\n  \"triggerCount\": 1,\n  \"tags\": [\n    {\n      \"createdAt\": \"2025-02-04T13:55:27.606Z\",\n      \"updatedAt\": \"2025-02-04T13:55:27.606Z\",\n      \"id\": \"sFbVSiMOCzwy8ZoJ\",\n      \"name\": \"Causacion\"\n    }\n  ]\n}"
}